{{- define "main" -}}

<div class='hx:mx-auto hx:flex hextra-max-page-width'>
  {{ partial "sidebar.html" (dict "context" .) }}
  <article
    class="hx:w-full hx:break-words hx:flex hx:min-h-[calc(100vh-var(--navbar-height))] hx:min-w-0 hx:justify-center hx:pb-8 hx:pr-[calc(env(safe-area-inset-right)-1.5rem)]">
    <main class="hx:w-full hx:min-w-0 hx:max-w-full hx:px-6 hx:pt-4 hx:md:px-12">
      {{ partial "breadcrumb.html" (dict "page" . "enable" true) }}
      <!-- Row header -->
      <header class="hx:mb-6">
        <h1 class="hx:text-3xl hx:font-bold">{{ .Title }}</h1>
        {{- with .Summary }}
        <p class="hx:mt-2 hx:text-gray-600 hx:dark:text-gray-300">{{ . }}</p>
        {{- end }}
      </header>

      <!-- Display cells horizontally -->
      {{- $rowBgColor := .Params.bg_color | default "transparent" -}}
      <div
        style="display: flex; flex-direction: column; height: calc(100vh - 12rem); background-color: {{ $rowBgColor }} !important;">
        <div class="hx:flex hx:gap-0 hx:mt-0 hx:overflow-x-auto" style="flex: 1; min-height: 0;">
          {{- $currentPage := . }}
          {{- range $currentPage.Sections }}
          {{- $bgColor := .Params.bg_color | default "transparent" -}}
          {{- $isTerminal := eq .Params.type "terminal" -}}
          {{- $titleColor := cond $isTerminal "#90ee90" "" -}}
          {{- $addBtnColor := cond $isTerminal "#90ee90" "" -}}
          <div
            class="hx:shrink-0 hx:w-64 hx:border hx:border-gray-200 hx:dark:border-neutral-700 hx:rounded-sm hx:p-0 hx:flex hx:flex-col"
            style="height: 100%; background-color: {{ $bgColor }} !important;">
            <h3
              class="hx:text-lg hx:font-semibold hx:mb-3 hx:shrink-0 hx:flex hx:items-center hx:justify-between hx:px-2">
              <a href="{{ .RelPermalink }}"
                class="{{ if not $isTerminal }}hx:text-blue-600 hx:dark:text-blue-400{{ end }} hx:hover:underline" {{ if
                $isTerminal }}style="color: {{ $titleColor }};" {{ end }}>{{ .Title
                }}</a>
              <div class="hx:flex hx:gap-1">
                <button
                  class="insert-cell-btn hx:ml-2 hx:font-bold hx:text-xl hx:cursor-pointer hx:bg-transparent hx:border-none {{ if not $isTerminal }}hx:text-green-600 hx:hover:text-green-700{{ end }}"
                  {{ if $isTerminal }}style="color: {{ $addBtnColor }};" {{ end }}
                  data-cell-path="content/{{ .File.Dir }}" data-cell-weight="{{ .Weight }}"
                  title="Insert cell to the right">+</button>
                <button
                  class="delete-cell-btn hx:font-bold hx:text-xl hx:cursor-pointer hx:bg-transparent hx:border-none"
                  style="color: #dc2626;" data-cell-path="content/{{ .File.Dir }}" data-cell-weight="{{ .Weight }}"
                  title="Delete cell file - No undo available!">-</button>
                <button
                  class="insert-terminal-cell-btn hx:font-bold hx:text-xl hx:cursor-pointer hx:bg-transparent hx:border-none {{ if not $isTerminal }}hx:text-blue-600 hx:hover:text-blue-700{{ end }}"
                  {{ if $isTerminal }}style="color: {{ $addBtnColor }};" {{ end }}
                  data-cell-path="content/{{ .File.Dir }}" data-cell-weight="{{ .Weight }}"
                  title="Add terminal cell">t</button>
              </div>
            </h3>
            <div class="hx:prose hx:prose-sm hx:dark:prose-invert hx:max-w-none hx:overflow-y-auto"
              contenteditable="true" data-cell-path="content/{{ .File.Dir }}" style="flex: 1; min-height: 0;">
              {{ .Content }}
            </div>
          </div>
          {{- end }}
        </div>
        <div
          class="hx:py-2 hx:px-4 hx:text-sm hx:text-gray-600 hx:dark:text-gray-400 hx:border-t hx:border-gray-200 hx:dark:border-neutral-700 hx:bg-gray-50 hx:dark:bg-neutral-800">
          {{ len $currentPage.Sections }} cells
        </div>
      </div>
    </main>
  </article>
</div>
{{- end }}