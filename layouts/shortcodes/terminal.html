{{- $id := printf "terminal-%d" (now.Unix) -}}
{{- $cwd := .Page.File.Dir -}}
<div class="terminal-wrapper"
  style="width: 100%; height: 100%; background-color: #000; border-radius: 4px; overflow: hidden; margin: 0;"
  data-cwd="content/{{ $cwd }}">
  <iframe id="{{ $id }}" style="width: 100%; height: 100%; border: none;" allow="fullscreen"></iframe>
</div>

<script>
  (function () {
    const iframeEl = document.getElementById('{{ $id }}');
    if (!iframeEl || iframeEl.dataset.initialized) return;

    const wrapper = iframeEl.parentElement;
    const cwd = wrapper.dataset.cwd || '';

    // Extract row directory path (go up one level from cell)
    const pathParts = cwd.replace(/\/$/, '').split('/').filter(p => p);
    const rowPath = pathParts.slice(0, -1).join('/'); // Remove cell directory, keep row

    console.log('CWD:', cwd);
    console.log('Row path:', rowPath);

    // Connect iframe to ttyd server
    // Note: ttyd should be started with: ttyd -p 7688 -W /path/to/workspace zsh
    iframeEl.src = 'http://localhost:7688';
    iframeEl.dataset.initialized = 'true';
  })();
</script>